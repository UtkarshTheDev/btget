name: Update Badges

on:
  push:
    branches: [main]
  schedule:
    # Run daily at 00:00 UTC to update download stats
    - cron: '0 0 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  update-badges:
    name: Update README Badges
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'

    - name: Get npm package info
      id: npm_info
      run: |
        # Fetch latest npm package info
        NPM_DATA=$(curl -s https://registry.npmjs.org/btget)
        LATEST_VERSION=$(echo $NPM_DATA | jq -r '.["dist-tags"].latest')
        echo "version=$LATEST_VERSION" >> $GITHUB_OUTPUT
        
        # Get download stats (last month)
        DOWNLOADS=$(curl -s https://api.npmjs.org/downloads/point/last-month/btget | jq -r '.downloads')
        echo "downloads=$DOWNLOADS" >> $GITHUB_OUTPUT

    - name: Create badge data
      run: |
        echo "Latest npm version: ${{ steps.npm_info.outputs.version }}"
        echo "Monthly downloads: ${{ steps.npm_info.outputs.downloads }}"
        
        # Badges are automatically generated by shields.io, this job just tracks the data
        # The actual badges in README.md use dynamic URLs

    - name: Commit badge updates
      run: |
        # This is a placeholder for any badge-related file updates
        # Currently, badges are dynamic and don't need file updates
        echo "Badges are dynamically generated from shields.io"
